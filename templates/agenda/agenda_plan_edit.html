{% load i18n %}
{% load humanize %}

{% comment %}
{% with assoc=plan.assoc %}
{% if assoc.is_multisectional %}
    {% set show_section = True %}
{% else %}
    {% set show_section = False %}
{% endif %}
{% endcomment %}

{% with assoc=plan.assoc gig=plan.gig band=plan.assoc.band section=plan.section%}
<div class="row" style="border-left:solid thick {{ assoc.colorval }};">
    <div class="col-sm-12 col-md-3">
        {{ gig.date|naturalday:"SHORT_DATE_FORMAT"|capfirst }} {{ gig.date|date:"D" }}
{% comment %}
Add the day of week to the short_date_format - can just append D?
{% endcomment %}

        {% if user.preferences.agenda_show_time and gig.schedule_time %}
            {{ gig.schedule_time }}
        {% endif %}
        <span style="display: inline-block; vertical-align: middle;">
        {% if gig.status == 1 %}
            <i class="fas fa-check-circle float-md-right" style="color:green"></i>
        {% elif gig.status == 2 %}
            <i class="fas fa-times-circle float-md-right" style="color:red"></i>
        {% else %}
            <i class="fas fa-question-circle float-md-right" style="color:orange"></i>
        {% endif %}
        </span>
    </div>
    <div class="col-sm-12 col-md-5">
        <a href="/gig/{{ gig.id }}" ><strong>{{ gig.title }}</strong></a>
        {% if user.band_count > 1 %}
            <a href="/band/{{ band.id }}">
            {% if band.shortname %}
                ({{ band.shortname }})
            {% else %}
                ({{ band.name }})
            {% endif %}
            </a>
        {% endif %}
    </div>
    {% if gig.status != 2 %}
        <div class="col-12 col-md-4 btn-group" role="group">
            {% include "gig/plan_icon_button.html" with simple_planning=band.simple_planning %}
            {% if band.plan_feedback %}
                {% include "gig/plan_feedback_button.html" with feedback_strings=band.feedback_strings %}
            {% endif %}
            {% if assoc.is_multisectional %}
                {% if band.sections.all|length > 1 %}
                <div class="dropdown mr-2">
                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" role="button" data-toggle="dropdown" id="sel-{{plan.id}}" aria-haspopup="true" aria-expanded="false">
                            {% if section == None %}
                                {% trans "section" %}...  <span class="caret"></span>
                            {% else %}
                                {{section.name }} <span class="caret"></span>
{% comment %}
TODO the section name had a 'shorten' filter
{% endcomment %}                                
                            {% endif %}
                        </button>
                        <div class="dropdown-menu" aria-labelledby="sel-{{plan.id}}">
                            {% for section in band.sections.all %}
                                <a class="dropdown-item" onclick="section_select('band/assoc','{{ assoc.id }}','sel-{{plan.id}}','{{ section.id }}', 
                                                                                '{{ section.name }}','{{ csrf_token}}')">{{ section.name }}</a>
{% comment %}
TODO the section name had a 'shorten' filter
{% endcomment %}                                
                                
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}
            {% if not plan.comment %}
                <a style="color:black; text-decoration: none; border-bottom: dashed 1px #0088cc;" href="#" id="comment-init-{{plan.id}}" onclick='show_comment("{{plan.id}}")'><i class="far fa-comment"></i></a>
            {% endif %}
        </div>
    {% else %}
        <div class="col-12 col-md-4">
            <strong>{% trans "Cancelled!" %}</strong>
        </div>
    {% endif %}
</div>
{% if gig.status != 2 %}
    <div class="row" style="border-left:solid thick {{ assoc.colorval }};{% if not plan.comment %}display:none;{% endif %}" id="comment-row-{{plan.id}}">
        <div class="ml-auto col-12 col-md-9">
            <a href="#" class="comment-thing" id="comment-{{plan.id}}" data-type="text" data-pk="{{plan.id}}" data-url="/gig/plan/{{ plan.id }}/comment" data-title="">{{plan.comment|default_if_none:""}}</a>
        </div>
    </div>
{% endif %}
{% endwith %}
